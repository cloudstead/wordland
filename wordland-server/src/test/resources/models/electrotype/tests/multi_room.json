[
  {
    "comment": "login as anonymous player 1",
    "request": { "session": "new", "uri": "auth/login", "method": "post" },
    "response": {
      "sessionName": "player1",
      "session": "apiToken"
    }
  },

  {
    "nested": {
      "iterate": {
        "room": "[1,2,3,4,5]"
      },
      "scripts": [
        {
          "comment": "join 5x5 board as player1, room #[[room]]",
          "request": {
            "session": "player1",
            "uri": "rooms/5x5/join",
            "entity": {}
          },
          "response": {
            "store": "p1room[[room]]",
            "check": [
              {"condition": "json.room.startsWith('5x5')"},
              {"condition": "[[room]] == 1 || p1room[[room]].room != p1room1.room"}
            ]
          }
        }
      ]
    }
  },

  {
    "comment": "list all current player's rooms",
    "request": { "uri": "me/rooms" },
    "response": {
      "store": "rooms",
      "check": [
        {"condition": "json.length == 5"},
        {"condition": "json[0].name.startsWith('5x5_')"}
      ]
    }
  },

  {
    "comment": "list all current player's rooms after restarting API",
    "before": "restart-api",
    "request": {
      "uri": "me/rooms"
    },
    "response": {
      "store": "rooms",
      "check": [
        {"condition": "json.length == 5"},
        {"condition": "json[0].name.startsWith('5x5_')"},
        {"condition": "json[0].roomState == 'awaiting'"},
        {"condition": "find(json, 'roomState', 'active') == null"},
        {"condition": "find(json, 'roomState', 'ended') == null"}
      ]
    }
  },

  {
    "comment": "login as anonymous player 2",
    "request": { "session": "new", "uri": "auth/login", "method": "post" },
    "response": {
      "sessionName": "player2",
      "session": "apiToken"
    }
  },

  {
    "comment": "join 5x5 board as player2, in first player1 room {{p1room1.room}}",
    "request": {
      "session": "player2",
      "uri": "rooms/{{p1room1.room}}/join",
      "entity": {}
    },
    "response": {
      "store": "p2room1",
      "check": [
        {"condition": "json.room.equals('{{p1room1.room}}')"}
      ]
    }
  },

  {
    "comment": "list all rooms for player2, should see one that is active",
    "request": {
      "session": "player2",
      "uri": "me/rooms"
    },
    "response": {
      "store": "rooms",
      "check": [
        {"condition": "json.length == 1"},
        {"condition": "json[0].name == '{{p2room1.room}}'"},
        {"condition": "json[0].roomState == 'active'"}
      ]
    }
  },

  {
    "comment": "list all rooms for player1, should see same one active",
    "request": {
      "session": "player1",
      "uri": "me/rooms"
    },
    "response": {
      "store": "rooms",
      "check": [
        {"condition": "json.length == 5"},
        {"condition": "find(json, 'name', '{{p1room1.room}}').roomState == 'active'"}
      ]
    }
  }

]