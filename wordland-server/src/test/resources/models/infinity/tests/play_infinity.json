[
  {
    "comment": "join infinity board as player1",
    "request": {
      "uri": "rooms/the_expanse/join",
      "entity": {
        "name": "player1"
      }
    },
    "response": {
      "store": "player1",
      "sessionName": "player1",
      "session": "apiKey",
      "check": [
        {"condition": "json.name == 'player1'"},
        {"condition": "json.id != null"}
      ]
    }
  },

  {
    "comment": "join infinity board as player2",
    "request": {
      "uri": "rooms/the_expanse/join",
      "entity": {
        "name": "player2"
      }
    },
    "response": {
      "store": "player2",
      "sessionName": "player2",
      "session": "apiKey",
      "check": [
        {"condition": "json.name == 'player2'"},
        {"condition": "json.id != null"}
      ]
    }
  },

  {
    "comment": "player 1 requests initial board state",
    "request": {
      "session": "player1",
      "uri": "rooms/the_expanse/board"
    },
    "response": {
      "store": "initial_board",
      "check": [
        {"condition": "json.x1 == 0"},
        {"condition": "json.x2 == 31"},
        {"condition": "json.y1 == 0"},
        {"condition": "json.y2 == 31"},
        {"condition": "json.tiles.length == 32"},
        {"condition": "json.tiles[0].length == 32"},
        {"condition": "json.tiles[0][0].unclaimed()"},
        {"condition": "json.tiles[0][1].unclaimed()"},
        {"condition": "json.tiles[0][2].unclaimed()"},
        {"condition": "json.tiles[2][0].unclaimed()"},
        {"condition": "json.tiles[3][0].unclaimed()"},
        {"condition": "json.tiles[4][5].unclaimed()"}
      ]
    }
  },

  {
    "comment": "player 1 requests board state, requires 4 game state blocks",
    "request": {
      "session": "player1",
      "uri": "rooms/the_expanse/board?x1=-5&x2=5&y1=-5&y2=5"
    },
    "response": {
      "check": [
        {"condition": "json.x1 == -5"},
        {"condition": "json.x2 == 5"},
        {"condition": "json.y1 == -5"},
        {"condition": "json.y2 == 5"},
        {"condition": "json.tiles.length == 11"},
        {"condition": "json.tiles[0].length == 11"},
        {"condition": "json.tiles[0][0].unclaimed()"},
        {"condition": "json.tiles[0][1].unclaimed()"},
        {"condition": "json.tiles[0][2].unclaimed()"},
        {"condition": "json.tiles[2][0].unclaimed()"},
        {"condition": "json.tiles[3][0].unclaimed()"},
        // ensure alignment with view of initial board state
        {"condition": "json.tiles[5][5].symbol == initial_board.tiles[0][0].symbol"},
        {"condition": "json.tiles[10][10].symbol == initial_board.tiles[5][5].symbol"},
        {"condition": "json.tiles[10][9].symbol == initial_board.tiles[5][4].symbol"}
      ]
    }
  },

  {
    "comment": "player 1 requests board state for large random area, server limits to 50x50",
    "request": {
      "session": "player1",
      "uri": "rooms/the_expanse/board?x1=-128&x2=109&y1=-132&y2=128"
    },
    "response": {
      "store": "big_board",
      "check": [
        {"condition": "json.tiles.length == 50"},
        {"condition": "json.tiles[0].length == 50"},
        {"condition": "json.tiles[0][0].unclaimed()"},
        {"condition": "json.tiles[0][1].unclaimed()"},
        {"condition": "json.tiles[0][2].unclaimed()"},
        {"condition": "json.tiles[49][49].unclaimed()"}
      ]
    }
  },

  {
    "comment": "player 1 plays word",
    "before": "find-word-and-tiles big_board player1_word1",
    "request": {
      "session": "player1",
      "uri": "rooms/the_expanse/play",
      "entity": {
        "room": "the_expanse",
        "stateChange": "word_played",
        "id": "{{player1.id}}",
        "clientId": "{{player1.id}}",
        "apiKey": "{{player1.apiKey}}",
        "word": "{{player1_word1.word}}",
        "tilesJson": "{{escaped_json player1_word1.tiles}}"
      }
    }
  },

  {
    "comment": "player 2 plays word",
    "before": "find-word-and-tiles big_board player2_word1",
    "request": {
      "session": "player2",
      "uri": "rooms/the_expanse/play",
      "entity": {
        "room": "the_expanse",
        "stateChange": "word_played",
        "id": "{{player2.id}}",
        "clientId": "{{player2.id}}",
        "apiKey": "{{player2.apiKey}}",
        "word": "{{player2_word1.word}}",
        "tilesJson": "{{escaped_json player2_word1.tiles}}"
      }
    }
  },

  {
    "comment": "player 1 requests more board state, verify updates",
    "request": {
      "uri": "rooms/the_expanse/board?x1=-128&x2=109&y1=-132&y2=128"
    },
    "response": {
      "store": "big_board",
      "check": [
        {"condition": "json.tiles.length == 50"},
        {"condition": "json.claimedWord('{{player1_word1.word}}')"},
        {"condition": "json.claimedWord('{{player1_word2.word}}')"}
      ]

    }
  }/*,

  {
    "comment": "restart server, player 1 requests board state, verify API call succeeds and all plays are there"
  }*/
]