[

  {
    "nested": {
      "iterate": {
        "player": "[1,2,3,4,5,6,7,8,9,10]"
      },
      "scripts": [
        {
          "comment": "login as player [[player]]",
          "request": {
            "session": "new",
            "uri": "auth/login",
            "entity": {"name": "player[[player]]"}
          },
          "response": {
            "store": "player[[player]]",
            "sessionName": "player[[player]]",
            "session": "apiToken"
          }
        },

        {
          "comment": "join fun_land board as player [[player]], ensure same room",
          "request": {
            "session": "player[[player]]",
            "uri": "rooms/fun_land/join",
            "entity": {}
          },
          "response": {
            "store": "p[[player]]room",
            "check": [
              {"condition": "json.player.name == 'player[[player]]'"},
              {"condition": "json.room.startsWith('fun_land')"},
              {"condition": "p1room.room == p[[player]]room.room"}
            ]
          }
        }
      ]
    }
  },

  {
    "comment": "player 1 requests initial board state",
    "request": {
      "session": "player1",
      "uri": "rooms/{{p1room.room}}/board?x2=50&y2=50"
    },
    "response": {
      "store": "board"
    }
  },

  {
    "nested": {
      "iterate": {
        "turn": "[1,2,3,4,5,6,7,8,9,10]"
      },
      "scripts": [
        {
          "nested": {
            "iterate": {
              "player": "[1,2,3,4,5,6,7,8,9,10]"
            },
            "paramStartDelim": "(",
            "paramEndDelim": ")",
            "scripts": [
              {
                "comment": "play word #[[turn]] for player ((player))",
                "before": "find-word-and-tiles board player((player))_word[[turn]] (2*[[turn]]) (3*[[turn]])",
                "request": {
                  "session": "player((player))",
                  "uri": "rooms/{{p1room.room}}/play",
                  "entity": {
                    "room": "{{p1room.room}}",
                    "stateChange": "word_played",
                    "id": "{{player((player)).id}}",
                    "clientId": "{{player((player)).id}}",
                    "apiToken": "{{player((player)).apiToken}}",
                    "word": "{{player((player))_word[[turn]].word}}",
                    "tilesJson": "{{escaped_json player((player))_word[[turn]].tiles}}"
                  }
                }
              }
            ]
          }
        }
      ]
    }
  },

  {
    "comment": "player 1 requests board overview for entire board",
    "request": {
      "session": "player1",
      "uri": "rooms/{{p1room.room}}/board/view.png?x1=-1000&x2=1000&y1=-1000&y2=1000&height=1000&width=1000"
    },
    "after": "save-board-view /tmp/views/big_board_{{date_format 'now' 'yyyy-MM-dd_HH-mm'}}.png"
  }
]